###
### supported params
### '@timeout 600' defaults to seconds, but supports ms, s, m
### '@connection-timeout 30' defaults to seconds, but supports ms, s, m
### @no-log: don't store history
### @no-cookie-jar: don't save response cookies
### @no-redirect
### < ./input.txt: read request body from input file
### * Environment variables defined in special environment files and available in any .http file.
###     add into environment with the json
###     use {{environment-variable-name}}
### * In-place variables defined in .http files and available within the same files only.
###     add into your .http file (it's scoped to the file): on single line: @myhost = example.org
###     use: GET {{myhost}}/stats
### * Global variables defined programmatically in response handler scripts using the client.global.set method.
### * Per-request variables defined using the request.variables.set method before a request and available in this request only.
###     add above your request:
###     < {%
###         request.variables.set("firstname", "John")
###     %}
###     use: GET http://example.org/{{firstname}}
###     this is a pre-request script - can be used to generate http signatures
### * Built-in dynamic variables with dynamically generated values.
###     - $uuid or $random.uuid, $timestamp, $isoTimestamp, $randomInt (between 0-1000), $random.integer(fromInclusive, toExclusive)
###     - $random.float(from, to), $random.alphabetic(length), $random.alphanumeric(length), $random.hexadecimal(length)
###     - $random.email, $exampleServer (built-in web server can only be accessed by this client. Used in GraphQL and WebSocket)
###
### collections
### < {%
###    request.variables.set("id", [1,2,3,4,5])
### %}
### GET http://localhost:8080/books/{{id}}
### pre-request scripts can define collections
### the request will run for each value in the collection - so 5 times for the example above
### you can use the variable in the body like:
### < {%
###     request.variables.set("name", ["Alice", "Bob", "Charlie"])
### %}
### GET http://localhost:8080/users
### Content-Type: application/json
###
### {
###   "name": {{name}}
### }

# @name get mltp token
POST {{auth-server}}
Authorization: Basic {{client-id}} {{client-secret}}
Content-Type: application/x-www-form-urlencoded

grant_type=client_credentials&scope=msr:mltp.all

> {%
    client.global.set('auth_token', response.body.access_token)
%}

###
## LO_SCORE_WEIGHTED_NAME_MATCHING_THRESHOLD = 75
## using TokenSetPartialMatcher algorithm
# @name name1v
GET {{host}}/{{api}}/member/lookup?term=abe
Authorization: {{auth-type}} {{auth_token}}
Accept-Language: en
X-LOGGED-IN-PERSON-UUID: 82b6042f-22c7-4267-bc85-48ee3c3c024c

> {%
    var length = 0;
    if (response.body != null) {
        for (var k in response.body.memberResults) {
            if (response.body.memberResults.hasOwnProperty(k)) length++;
        }
    }
    client.test("Request executed successfully", function() {
        client.assert(response.status === 200 || response.status === 204, "Response status is not 200");
    });
    client.test("There are " + length + " results expecting 15", function () {
        client.assert(length === 15, "did not get all the expected results")
    })
%}
###
# @name name2v
GET {{host}}/{{api}}/member/lookup?term=kristian
Authorization: {{auth-type}} {{auth_token}}
Accept-Language: en
X-LOGGED-IN-PERSON-UUID: b3aeaa0b-b200-4d56-92ce-81c7c39329c3

> {%
    var length = 0;
    if (response.body != null) {
        for (var k in response.body.memberResults) {
            if (response.body.memberResults.hasOwnProperty(k)) length++;
        }
    }
    client.test("Request executed successfully", function() {
        client.assert(response.status === 200 || response.status === 204, "Response status is not 200");
    });
    client.test("There are " + length + " results expecting 3", function () {
        client.assert(length === 3, "did not get all the expected results")
    })
%}

###
# @name name3
GET {{host}}/{{api}}/member/lookup?term=Hiroshi Tanaka
Authorization: {{auth-type}} {{auth_token}}
Accept-Language: en
X-LOGGED-IN-PERSON-UUID: 5d11e365-51c4-4d27-aaa1-d42cfbaa6777

> {%
    client.test("Request executed successfully", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
    client.test("Body has data", function () {
        client.assert(response.body != null, "Body should contain data")
    })
%}

###
# @name name4
GET {{host}}/{{api}}/member/lookup?term=Hiroshi
Authorization: {{auth-type}} {{auth_token}}
Accept-Language: en
X-LOGGED-IN-PERSON-UUID: 5d11e365-51c4-4d27-aaa1-d42cfbaa6777

> {%
    client.test("Request executed successfully", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
    client.test("Body has data", function () {
        client.assert(response.body != null, "Body should contain data")
    })
%}

###
# @name name5
GET {{host}}/{{api}}/member/lookup?term=John
Authorization: {{auth-type}} {{auth_token}}
Accept-Language: en
X-LOGGED-IN-PERSON-UUID: 5d11e365-51c4-4d27-aaa1-d42cfbaa6777

> {%
    client.test("Request executed successfully", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
    client.test("Body has data", function () {
        client.assert(response.body != null, "Body should contain data")
    })
%}

###
# @name name6
GET {{host}}/{{api}}/member/lookup?term=Ivón Palomino
Authorization: {{auth-type}} {{auth_token}}
Accept-Language: en
X-LOGGED-IN-PERSON-UUID: dc774ecf-baaa-4c79-9108-7c9f54eff032
X-REQUESTED-TARGET-PERSON-UUID: c4b6844f-1193-4373-97d6-2fa7b22fc288

> {%
    client.test("Request executed successfully", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
    client.test("Body has data", function () {
        client.assert(response.body != null, "Body should contain data")
    })
%}

###
# as of 8/10/2024 - msi is null because this is a mission president (getting NPE)
# update switch to include MISSION in getUnitsToSearch
# @name name7
GET {{host}}/{{api}}/member/lookup?term=anak
Authorization: {{auth-type}} {{auth_token}}
Accept-Language: en
X-LOGGED-IN-PERSON-UUID: dc774ecf-baaa-4c79-9108-7c9f54eff032
X-REQUESTED-TARGET-PERSON-UUID: a659c731-c5b6-4dfc-b22b-e8eb91f02c07
X-ACTIVE-POSITION: 9
X-ACTIVE-POSITION-UNIT: 2018756

> {%
    client.test("Request executed successfully", function() {
        client.assert(response.status === 204, "Response status is not 200");
    });
    client.test("Body is empty", function () {
        client.assert(response.body === null, "Body should be empty")
    })
%}

###
# partial words are only searched in email, names don't currently support it
# @name name8
GET {{host}}/{{api}}/member/lookup?term=and
Authorization: {{auth-type}} {{auth_token}}
Accept-Language: en
X-LOGGED-IN-PERSON-UUID: 9d75015c-b5cd-4bae-be41-9f5a83a90c1f

> {%
    client.test("Request executed successfully", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
    client.test("Body has content!", function () {
        client.assert(response.body != null, "Body should NOT be empty")
    })
%}

###
# @name name9
GET {{host}}/{{api}}/member/lookup?term=Hindira Liberty Cáceres Huallpa
Authorization: {{auth-type}} {{auth_token}}
X-LOGGED-IN-PERSON-UUID: dc774ecf-baaa-4c79-9108-7c9f54eff032
X-REQUESTED-TARGET-PERSON-UUID: 78763814-a17e-4fab-9fc3-0ac734428824
Accept-Language: en

> {%
    client.test("Request executed successfully", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
    client.test("Body has content!", function () {
        client.assert(response.body != null, "Body should NOT be empty")
    })
%}

###
# @name name10
GET {{host}}/{{api}}/member/lookup?term=Hiroshi
Authorization: {{auth-type}} {{auth_token}}
X-LOGGED-IN-PERSON-UUID: 886d7b43-f10f-4088-b7c7-c265832b3f6c
Accept-Language: en

> {%
    client.test("Request executed successfully", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
    client.test("Body has content!", function () {
        client.assert(response.body != null, "Body should NOT be empty")
    })
%}

###
### dual role MP as MP here
# @name name11
GET {{host}}/{{api}}/member/lookup?term=anak
Authorization: {{auth-type}} {{auth_token}}
X-LOGGED-IN-PERSON-UUID: a659c731-c5b6-4dfc-b22b-e8eb91f02c07
Accept-Language: en

> {%
    var length = 0;
    for (var k in response.body.memberResults) {
        if (response.body.memberResults.hasOwnProperty(k)) length++;
    }
    console.log("resultCount: " + length);
    client.test("There are many results", function () {
        client.assert(length > 1, "did not get all the expected results")
    })
%}

###
### dual role MP as Branch President
# @name name12
GET {{host}}/{{api}}/member/lookup?term=anak
Authorization: {{auth-type}} {{auth_token}}
X-LOGGED-IN-PERSON-UUID: dc774ecf-baaa-4c79-9108-7c9f54eff032
X-REQUESTED-TARGET-PERSON-UUID: a659c731-c5b6-4dfc-b22b-e8eb91f02c07
X-ACTIVE-POSITION: 363
X-ACTIVE-POSITION-UNIT: 420387
Accept-Language: en

> {%
    var length = 0;
    for (var k in response.body.memberResults) {
        if (response.body.memberResults.hasOwnProperty(k)) length++;
    }
    console.log("resultCount: " + length);
    client.test("There are 1 results", function () {
        client.assert(length > 1, "did not get all the expected results")
    })
%}

###
### user with district auditor role should get 403
# @name name13
GET {{host}}/{{api}}/member/lookup?term=Juan
Authorization: {{auth-type}} {{auth_token}}
X-LOGGED-IN-PERSON-UUID: dc774ecf-baaa-4c79-9108-7c9f54eff032
X-REQUESTED-TARGET-PERSON-UUID: 6cd47b81-c293-45ca-81fe-0f6cc30c0c61
X-ACTIVE-POSITION: 1408
X-ACTIVE-POSITION-UNIT: 614246
Accept-Language: en

###
### should get Kris' son and many other Landons
# @name name14
GET {{host}}/{{api}}/member/lookup?term=Landon
Authorization: {{auth-type}} {{auth_token}}
X-LOGGED-IN-PERSON-UUID: 89ec93ba-95df-4a5d-bd5e-59f142c5a307
X-REQUESTED-TARGET-PERSON-UUID: b3aeaa0b-b200-4d56-92ce-81c7c39329c3
X-ACTIVE-POSITION: 52
X-ACTIVE-POSITION-UNIT: 1121979
Accept-Language: en

> {%
    if (response.body != null) {
        var length = 0;
        for (var k in response.body.memberResults) {
            if (response.body.memberResults.hasOwnProperty(k)) length++;
        }
        console.log("resultCount: " + length);
    }
%}

###
### chinese stake matches "a"
# @name name15
GET {{host}}/{{api}}/member/lookup?term=jonq30
Authorization: {{auth-type}} {{auth_token}}
X-LOGGED-IN-PERSON-UUID: 837d9505-ddd2-402b-bcf6-bb21bd0f8643
Accept-Language: en

> {%
    client.test("Request executed with no content back", function() {
        client.assert(response.status === 204, "Response status is not 204");
    });
    client.test("Body should be empty", function () {
        client.assert(response.body === null, "Body has content")
    })
%}
