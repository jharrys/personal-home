## Converting a legacy weblogic web app to spring-boot web app

This note is also a note for the carma web application and the steps I took to convert it to a spring-boot self-runnable web app (using spring-boot's tomcat embedded container).

This is a multi-module application as well. It's comprised of approximately 9 spring libraries (not spring-boot).

It's important to note that under weblogic it works as it is. All the spring beans are created without any of the required changes I'm outlining in this note.

A big note that I learned.

Inside weblogic the aop proxies are created using jdk-proxy, which uses interfaces. jdk-proxy doesn't try to extend concrete classes for their proxies, it implements interfaces.

Spring-boot defaults to using cglib proxy's. Cglib attempts to extend from concrete classes. If the classes are final, this won't work.

1. There are about 3 or 4 libraries that create dataSource beans. Although under weblogic it works fine, for some reason spring-boot doesn't like it. 
    
    To fix this for spring-boot I annotated one of the libraries with one of the dataSource beans with primary=true (or @Primary if Java configured)
    
    **Note** there should be a way that this is note required, but I haven't found it.
    
    **Note2** the main reason it needs a primary defined is for some default beans that spring auto creates ... my tests are incomplete so this is a theory.
    
    **Note3** i chose the knowledge-manager library dataSource to make primary (for datasource and entitymanager)
    
3. I had to do the same as the dataSource for the entityManager.
4. This step is an intermediary step until I learn the proper way of configuring the transaction manager to not use cglib.

    In this step I commented out all @Transactional annotations that were on the Dao implementations in the protocol-manager library.
    
    **Note** this should change once I figured out the proper way to declare the transaction managers.

6. Most of the changes I made were in the module that packages everything as a WAR.
    7. I modified the pom file to include the wlthint3client 12.1.3 ... this was needed because we still depend on a library that connects to ejb's (clinicaldata-manager). 
    8. I also included com.sun.mail/javax.mail 1.5.6
    9. Then added spring-boot-starter-data-jpa
    10. Under build/plugins added spring-boot-maven-plugin with a goal of **repackage**
    11. Added a class org.ihc.hwcir.protocols.Application.java
    12. the class is defined as follows: the implements WebApplicationInitializer allows weblogic to continue to be the container if we wanted too (haven't test this yet)
    
            @ImportResource({"bpmn-spring.xml", "km-spring.xml", "cpm-spring.xml","fhir-spring.xml","hdd-spring.xml", "processmanager-spring.xml","pm-spring.xml","pts-spring.xml","report-manager-spring.xml"})

            @SpringBootApplication
            public class Application extends SpringBootServletInitializer implements WebApplicationInitializer {
    
    14. created application.properties file with the following
    
            server.display-name=Carma War
            server.port=7001
            server.contextPath=/carma-war
            spring.dao.exceptiontranslation.enabled=false
            #spring.aop.proxy-target-class=false
        
    16. 