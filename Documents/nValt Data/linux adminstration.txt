## Print routing table

        netstat -r

## Fixing Sendmail

1. yum install sendmail-cf package
2. modify /etc/mail/sendmail.mc
3. look for "SMART-HOST" and modify with correct mx setting (dig med.ge.com mx)
4. modify localhost.localdomain
5. when done run /etc/mail/make

### MASQUERADE
1. Look for masquerade_as and the other directives

### TESTING Sendmail rules
1. Start sendmail -> sendmail -bt
2. Set the flag -> /tryflags ES
3. `$ /try esmtp root`
4. `$ /try esmpt root@localhost`
5. `$ /try esmtp root@localhost.localdomain`

### THE .forward file (my username is lpjharri for this example)
1. needs to be mod 600
2. can have multiple lines for different address
3. use \ in front of the name to stop forwarding after sending it (for infinite loops): to send to bob’s local acct “\bob”
4. to keep a copy in my own local mailbox (i’m lpjharri) then: “\lpjharri”
5. can send to program or pipe also: “|/path/to/program args”
6. other email addresses can be placed on seperate lines or on same line with a comma separating each
7. files can be specified on its own line: /path/to/file.backup

### New mail notification under Bash/Zsh
1. MAILCHECK=0 # turns of checking
2. MAILCHECK=60 # checks every sixty seconds
3. MAILPATH=(/var/mail/lpjharri’?New mail has arrived.’) # (BASH) where to check mail and the message to output
4. mailpath=(/var/mail/lpjharri’?New mail has arrived.’) # (ZSH) where to check mail and the message to output
5. MAIL=/var/mail/lpjharri # this variable will be used if MAILPATH is not set
6. Currently not working under powerline or oh-my-zsh

## Autofs/Automount through a firewall

---

The below did not work for me on July 31, 2009 - so instead because
I use VPN to a trusted network, I decided to fully trust the interface
that gets used for the VPN (tun+)

---

* The following RPC ports are usually random and so to make it work
* through a firewall you would need open up everything.
* To make it work with a firewall, edit the /etc/sysconfig/nfs

> John Harris - My updates to make these RPC ports non-random
RQUOTAD_PORT=4000
LOCKD_TCPPORT=4001
LOCKD_UDPPORT=4001
MOUNTD_PORT=4002
STATD_PORT=4003
STATD_OUTGOING_PORT=4004

## CUPS

More information can be found on the CUPS website: <http://www.cups.org/documentation.php>

### Basic CUPS commands

cancel
: Allows you to cancel all jobs, all jobs on a specific printer or individual jobs

lpq
: show printer queue status on specific printer, or all printers

lpq -P printername
: lists all queued jobs on target printer

accept
: accept jobs sent to a destination

reject
: reject jobs sent to a destination

lp
: show printer queue status on specific printer, or all printers

lpq -P printername
: lists all queued jobs on target printer

lp
: submits files for printing or alters a pending job

lpadmin
: configure cups printers and classes

lpadmin -x printername
: deletes target printer

lpinfo
: lists the available devices or drivers known to the CUPS server

lpmove
: moves the specified job or all jobs from source to destination

lpoptions
: display or set printer options and defaults

lprm
: cancels print jobs that have been queued for printing

lpstat
: displays status information about the current classes, jobs, and printers

lpstat -t
: Lists all printers and all status information

lpstat -a
: Lists all printers and accepting state

### Printer hangs up on a job
1. Turn off the printer 2. Ssh into the print server 3. lpq -P PrinterName 4. This will list all jobs queued on the hung printer. In most cases, deleting all submitted jobs is safest 5. Cancel -a PrinterName 6. Cancels all submitted jobs on target printer 7. Restart printer 
### Check that jobs are printing
1. cancel -a `lpstat -t | grep disabled | awk '{print $2}'` 2. This will list all printers that are currently disabled, and cancel queued jobs on those printers 3. /usr/bin/enable `lpstat -t | grep disabled | awk '{print $2}'` 4. This will re-enable the stopped print queues 5. lpstat -t | grep disabled | awk '{print $2}' 
### This checks to see that all printers are re-enabled. Should return nothing.

Remove printers from client computer

1. lpadmin -x `lpstat -a | awk '{printf $1 " "}'` 
Lists all printers on client, sorts the printer names into a string, then issues lpadmin -x (removal) command to each printer. Command only deletes a printer at a time right now.

## Virtualization with QEMU/KVM

1. Using without virt-manager - virt-manager doesn't allow me to take advantage of qemu's "-vga std" option, which allows me to go with a high resolution
2. Virt-manager would handle automatically creating the vnetX interface, so I had to found out how to do it manually

## TAP interface & vnetX (for fedora)
1. Create /etc/qemu-ifup
        #!/bin/bash
        bridge=virbr0
        ifconfig $1 0.0.0.0 up
        brctl addif $bridge $1 || true

2. Create /etc/qemu-ifdown
        #!/bin/bash
        bridge=virbr0
        brctl delif $bridge $1 || true
        ifconfig $1 down

3. Make sure you call with (where x is 0,1,2....)

        -net nic,vlan=0 -net tap,vlan=0,ifname=vnetx

4. virbr0 should already exist and be started on startup

5. For resolutions greater than 1024x768, use the option -vga std (works for my 1920x1200)

## Multi-homed with GE/IHC to access google talk and google docs

1. Used Intmt's guest wireless to "dig talk.google.com", "dig docs.google.com"
2. Add IP's to /etc/hosts
3. Used Network Manager applet to add routes to wireless connection for Intmt's guest wireless
4. it works

## Getting VPNC to work with FC11

1. Get the *.pfc config files from the Windows box
2. Get pcf2vpnc.pl script I found (search pcf2vpnc.pl inside google docs here)
3. Use pcf2vpnc.pl to convert the pcf config files to vpnc config file
4. This will give you the group password
5. Then use these config settings to manually setup with the config tool off of the desktop

## Working with NIS to add to group

Do this on the NIS Master

        usermod -a -G groupname user
        make -C /var/yp


## Unix iostat command

        nohup iostat -xtnd 300 300 > iosfilename &

The first 300 is in seconds and is the collection interval
The second 300 is the number of collection interval to collect
Once you have this data, examine it to see the following:

        -poor service times (usually 20 msec or greater)
        -Presence of wait time (usually 20 msec or greater)
        -Presence of queued IO in Wait queue (usually 2 or more)

All of the above symptoms should exist, not just one or more and for at least (3) collection intervals in time (15 minutes)….

## Unix sort command

1. Sort numbers correctly instead of:
text1
text10
text2
text20
text3
text30
**want this:**
text1
text2
text3
text10
text20
text30

        sort -k field.charactern
        echo -e "3\n1\n20\n10\n2\n30" |sort -k 1.5n

## Redhat Automounting

1. update /etc/auto.master with:

        +auto.master
        /misc   /etc/auto.misc
        /home   /etc/auto.home  --timeout=60
        /net    -hosts
        +auto.master

2. Create the /etc/auto.home (the & is important at the end)

        *       -rw,soft        3.232.235.204:/vol/home/&


## tail functionality

        tail -f  ## by default follows the file descriptor, so if file name changes it still follows the file
        tail --follow=name  ## will follow the name of the file instead of fd ... good if you want to follow a log file that gets auto rotated
        tail -f --pid=PID -s X ## -s sleep interval, defaults to 1 second

## Mount iso and r/w then burn

        mkdir /media/FC5
        mount -o loop FC5.iso /media/FC5
        # copy to new area with write rights - iso9660 is a read-only fs
        cp -rp /media/FCS /to/new/area
        # for cd burning
        growisofs -V "Fedora Core 5" /dev/cdrom=FC5.iso

        # for dvd burning
        growisofs --dvd-compat -V "Fedora Core 5" /dev/dvd=FC5.iso

## mkisofs

        mkisofs -o $ISONAME.iso -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -l -allow-leading-dots -relaxed-filenames -joliet-long -max-iso9660-filenames -D -R -J -T -V VOLUMENAMEORID -v /path/to/directory/full/of/files

        # The above created an ISO fine, but not for RHEL5.2 boot install disk - try this way instead
        mkisofs -r -N -allow-leading-dots -d -J -T -b isolinux.bin -c boot.cat -no-emul-boot -V "Helix Custom RHEL 5U2" -boot-load-size 4 -boot-info-table -o /tmp/helixCustomRhel5u2.iso .

## Manually reconfigure IPv4 networking

        # /etc/sysconfig/network
        NETWORKING_IPV6=yes
        HOSTNAME=ecis202.eng.med.ge.com
        NETWORKING=yes
        GATEWAY=3.232.235.254
        NISDOMAIN=ECISLAB

        # /etc/sysconfig/network-scripts/ifcfg-eth0
        DEVICE=eth0
        BOOTPROTO=static
        HWADDR=00:16:3E:46:E2:F5
        IPADDR=3.232.235.202
        NETMASK=255.255.255.0
        ONBOOT=yes

## More info on ifcfg files

You can also edit the configuration file for a given network interface by hand. Below is a listing of the parameters one can expect to configure in an interface configuration file.
Within each of the interface configuration files, the following values are common:

* BOOTPROTO=\<protocol\>, where \<protocol\> is one of the following:
    * dhcp: The DHCP protocol should be used.
* BROADCAST=\<address\>, where \<address\> is the broadcast address. This directive is deprecated.
* DEVICE=\<name\>, where \<name\> is the name of the physical device (except dynamically-allocated PPP devices where it is the logical name).
* DNS\{1,2\}=\<address\>, where \<address\> is a name server address to be placed in /etc/resolv.conf if the PEERDNS directive is set to yes.
* IPADDR=\<address\>, where \<address\> is the IP address.
* NETMASK=\<mask\>, where \<mask\> is the netmask value.
* NETWORK=\<address\>, where \<address\> is the network address. This directive is deprecated.
* ONBOOT=\<answer\>, where \<answer\> is one of the following:
    * yes — This device should be activated at boot-time.
    * no — This device should not be activated at boot-time.
* PEERDNS=\<answer\>, where \<answer\> is one of the following:
  * yes — Modify /etc/resolv.conf if the DNS directive is set. If you are using DCHP, then yes is the default.
  * no — Do not modify /etc/resolv.conf.
  * SRCADDR=\<address\>, where \<address\> is the specified source IP address for outgoing packets.
  * USERCTL=\<answer\>, where \<answer\> is one of the following:
      * yes: Non-root users are allowed to control this device. 
      * no: Non-root users are not allowed to control this device.

## Local DNS and HOSTS

        # /etc/hosts
        3.232.235.202 ecis202.eng.med.ge.com ecis202
        
        # /etc/resolv.conf
        search eng.med.ge.com
        search blah
        nameserver 3.232.239.200

## Redhat run firstboot config

        /usr/sbin/firstboot --reconfig

## Mounting to windows share - use CIF

        # don't forget to shutdown any firewalls (on new GE systems had to shutdown sophos firewall on the windows side)
        mount -t cifs -o user=xxx,password=yyy,domain=gemedamerica //ip.address/snap_views /mnt/cifs

## Virtual commands for Xen, and Virsh

        sudo xm list
        
        sudo virsh list
        
        sudo xm destroy <vm>
        
        sudo virsh shutdown <vm>
        
        sudo virsh undefine <vm>
        
        # IR2 link
        virt-install --name=<vm> --ram=2048 --vcpu=2 --file=/var/lib/xen/images/<vm>_root.img --file-size=30 --bridge=xenbr0 --paravirt --nographics --location=http://ecis002.eng.med.ge.com/cobbler/ks_mirror/rhel5u2-x86_64/ --extra-args="ks=http://ecis002.eng.med.ge.com/cblr/svc/op/ks/profile/helix-stack01 ip=3.232.235.<ip> netmask=255.255.255.0 gateway=3.232.235.254 dns=3.232.239.200"
        
        # IR3 link
        virt-install --name=<vm> --ram=2048 --vcpu=2 --file=/var/lib/xen/images/<vm>_root.img --file-size=30 --bridge=xenbr0 --paravirt --nographics --location=http://ecis002.eng.med.ge.com/cobbler/ks_mirror/rhel5u3-x86_64/ --extra-args="ks=http://ecis002.eng.med.ge.com/cblr/svc/op/ks/profile/helix-stack02 ip=3.232.235.<ip> netmask=255.255.255.0 gateway=3.232.235.254 dns=3.232.239.200"
        
        # After spinning, to exit the console,
        ^]
        
        cp /etc/xen/<vm> /var/lib/xen/config/
        
        virsh shutdown <vm>
        
        xm create /var/lib/xen/config/<vm>
        
        virsh console ecis202
        
        # To create access to the /deploy share:
        
        sudo vi /etc/auto.direct
        
        /deploy -rw,soft        3.232.235.204:/vol/deploy
        
        sudo vi /etc/auto.master
        
        # (and add ...)
        
        /-      /etc/auto.direct
        
        sudo service autofs restart


